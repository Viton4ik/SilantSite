{% extends 'App/default.html' %}


{% load static %}


{% block indexHead %}
    <title>Рекламация</title>
{% endblock indexHead %}


{% block user %}
    <div class="user">
       <div>Пользователь: <em>"{{user}}"</em></div> 
       <div>Информация о рекламациях вашей техники</div>
       <div>
            <a href="{% url 'mainPage' %}"><button class="tableChangeButtons">Машины</button></a>
            <a href="{% url 'maintenancePage' %}"><button class="tableChangeButtons">Техническое обслуживание</button></a>    
            <a href="{% url 'claimPage' %}"><button class="tableChangeButtons" style="background-color:#EBE6D6;">Рекламации</button></a>    
       </div>
    </div>

{% endblock user %}


{% block filter %}
    <div class="filter">
        <form class="filterForm" method="get" action="{% url 'claimPage' %}">

            <label for="malfunction_node"> Узел отказа: </label>
            <select name="malfunction_node" id="malfunction_node">
                <option value="">All</option>
                {% for model in malfunction_node %}
                    <option value="{{ model }}" {% if model == filter_malfunction_node %}selected{% endif %}>{{ model }}</option>
                {% endfor %}
            </select>

            <label for="reparing_method"> &nbsp;Способ восстановления: </label>
            <select name="reparing_method" id="reparing_method">
                <option value="">All</option>
                {% for model in reparing_method %}
                    <option value="{{ model }}" {% if model == filter_reparing_method %}selected{% endif %}>{{ model }}</option>
                {% endfor %}
            </select>

            <label for="service_company"> &nbsp;Cервисная компания: </label>
            <select name="service_company" id="service_company">
                <option value="">All</option>
                {% for model in service_company %}
                    <option value="{{ model }}" {% if model == filter_service_company %}selected{% endif %}>{{ model }}</option>
                {% endfor %}
            </select>

            &nbsp;<button class="filterButtons" id="buttonApplyFilterMain" type="submit">Применить фильтр</button>
            &nbsp;<button class="filterButtons" id="resetButtonFilterMain">Сбросить фильтр</button>
        </form>
    </div>
    <div class="user">
        <div>таблица с данными (выдача результата)</div>
     </div>
{% endblock filter %}


{% block mainPage %}

    {% if claim %}
    <div class="mainView">
        <table class="tableVehicles">

            <tr style="background-color: #163E6C">
                <td style="text-align: center;">Зав. № машины</td>
                <td style="text-align: center;">Дата отказа</td>
                <td style="text-align: center;">Наработка, м/час</td>
                <td id="malfunctionNodeRowName" style="text-align: center;">Узел отказа</td>
                <td style="text-align: center;">Описание отказа</td>
                <td id="reparingMethodRowName" style="text-align: center;">Способ восстановления</td>
                <td style="text-align: center;">Используемые запасные части</td>
                <td style="text-align: center;">Дата восстановления</td>
                <td style="text-align: center;">Время простоя техники, час</td>
                <td id="serviceCompanyRowName" style="text-align: center;">Сервисная компания</td>
            </tr>
        
        {% for claim in page %}

                <tr style="background-color:{% cycle 'white' '#EBE6D6' %}; text-align: center;">

                        <td >{{ claim.vehicle }}</td>
                        <td >{{ claim.claimDate }}</td>
                        <td >{{ claim.operatingTime }}</td>
                        <td class="malfunctionNodeRow">{{ claim.malfunctionNode }}</td>
                        <td >{{ claim.malfunctionDescription }}</td>
                        <td class="reparingMethodRow">{{ claim.reparingMethod }}</td>
                        <td >{{ claim.usedSpareParts }}</td>
                        <td>{{ claim.repairingDate }}</td>
                        <td >{{ claim.vehicleDowntime }}</td>
                        <td class="serviceCompanyRow">{{ claim.serviceCompany }}</td>

                </tr>
        {% endfor %}
        </table>   
    {% else %}
        <h2>No claims</h2>
    {% endif %}
    </div>
    <script src="{% static 'js/claim.js' %}"></script>

{% endblock mainPage %}


{% block pagination %}

{# Добавляем пагинацию на страницу #}
<div class="paginator" style="text-align: center;">Page: 
    {# Добавляем "<" #}
    {% if page.has_previous %}
       <a href="?page={{ page.previous_page_number }}"><</a>
    {% endif %}

    {# Информация о предыдущих страницах #}
    {% if page.has_previous %}
       <a href="?page=1">1</a>
       {% if page.previous_page_number != 1 %}
           ...
           <a href="?page={{ page.previous_page_number }}">{{ page_obj.previous_page_number }}</a>
       {% endif %}
    {% endif %}

    {# Информация о текущей странице #}
    {{ page.number }}

    {# Информация о следующих страницах #}
    {% if page.has_next or page.next_page_number == page.paginator.num_pages %}
        {% if page.next_page_number != page.paginator.num_pages %}
            <a href="?page={{ page.next_page_number }}">{{ page.next_page_number }}</a>
        {% endif %}
        {% if paginator.num_pages != page.next_page_number %}
           ...
           <a href="?page={{ page.paginator.num_pages }}">{{ page.paginator.num_pages }}</a>
        {% endif %}
    {% endif %}

    {# Добавляем ">" #}
    {% if page.has_next %}
       <a href="?page={{ page.next_page_number }}">></a>
    {% endif %}
</div>
{% endblock pagination %}
